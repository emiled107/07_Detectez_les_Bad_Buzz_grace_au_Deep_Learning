FROM python:3.9-slim

RUN pip install --no-cache-dir mlflow boto3

WORKDIR /mlflow

EXPOSE 5000

ARG BACKEND_STORE_URI
ARG DEFAULT_ARTIFACT_ROOT
ARG MLFLOW_S3_ACCESS_KEY_ID
ARG MLFLOW_S3_SECRET_ACCESS_KEY
ARG MLFLOW_S3_ENDPOINT_URL
ARG MLFLOW_TRACKING_USERNAME
ARG MLFLOW_TRACKING_PASSWORD

ENV BACKEND_STORE_URI=$BACKEND_STORE_URI
ENV DEFAULT_ARTIFACT_ROOT=$DEFAULT_ARTIFACT_ROOT
ENV AWS_ACCESS_KEY_ID=$MLFLOW_S3_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$MLFLOW_S3_SECRET_ACCESS_KEY
ENV MLFLOW_S3_ENDPOINT_URL=$MLFLOW_S3_ENDPOINT_URL
ENV MLFLOW_TRACKING_USERNAME=$MLFLOW_TRACKING_USERNAME
ENV MLFLOW_TRACKING_PASSWORD=$MLFLOW_TRACKING_PASSWORD

COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
